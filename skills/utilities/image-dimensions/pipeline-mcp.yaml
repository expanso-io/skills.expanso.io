name: "image-dimensions-mcp"
type: pipeline

config:
  http:
    enabled: true
    address: "0.0.0.0:${PORT:-8080}"

  input:
    http_server:
      path: /dimensions
      allowed_verbs: [POST]
      timeout: 30s

  pipeline:
    processors:
      - mapping: |
          meta trace_id = uuid_v4()
          let w = this.width.or(0).number()
          let h = this.height.or(0).number()

          let pixels = $w * $h
          let mp = $pixels / 1000000
          let ratio = if $h > 0 { $w / $h } else { 0 }

          let ar = if ($ratio > 1.7 && $ratio < 1.8) { "16:9" } else if ($ratio > 1.3 && $ratio < 1.4) { "4:3" } else if ($ratio > 0.99 && $ratio < 1.01) { "1:1" } else { $w.string() + ":" + $h.string() }

          root.width = $w
          root.height = $h
          root.megapixels = $mp
          root.aspect_ratio = $ar
          root.orientation = if $w > $h { "landscape" } else if $h > $w { "portrait" } else { "square" }
          root.metadata = {"skill": "image-dimensions", "mode": "mcp", "trace_id": meta("trace_id"), "timestamp": now()}

  output:
    sync_response: {}
