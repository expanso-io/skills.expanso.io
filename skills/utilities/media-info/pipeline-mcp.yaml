name: "media-info-mcp"
type: pipeline

config:
  http:
    enabled: true
    address: "0.0.0.0:${PORT:-8080}"

  input:
    http_server:
      path: /info
      allowed_verbs: [POST]
      timeout: 30s

  pipeline:
    processors:
      - mapping: |
          meta trace_id = uuid_v4()
          let filename = this.filename.or("").string().lowercase()
          let size = this.size_bytes.or(0).number()

          let parts = $filename.split(".")
          let ext = if $parts.length() > 1 { $parts.index($parts.length() - 1) } else { "" }

          let type = match $ext {
            "jpg" => "image",
            "jpeg" => "image",
            "png" => "image",
            "gif" => "image",
            "mp3" => "audio",
            "wav" => "audio",
            "mp4" => "video",
            "webm" => "video",
            _ => "unknown"
          }

          root.filename = $filename
          root.extension = $ext
          root.type = $type
          root.size_bytes = $size
          root.is_media = $type != "unknown"
          root.metadata = {"skill": "media-info", "mode": "mcp", "trace_id": meta("trace_id"), "timestamp": now()}

  output:
    sync_response: {}
