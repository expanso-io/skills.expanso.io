name: "semver-parse-mcp"
type: pipeline

config:
  http:
    enabled: true
    address: "0.0.0.0:${PORT:-8080}"

  input:
    http_server:
      path: /parse
      allowed_verbs: [POST]
      timeout: 30s

  pipeline:
    processors:
      - mapping: |
          meta trace_id = uuid_v4()
          let input = this.version.or(content()).string().trim().trim_prefix("v")

          let parts = $input.split(".")
          let major = if $parts.length() >= 1 { $parts.index(0).number().catch(0) } else { 0 }
          let minor = if $parts.length() >= 2 { $parts.index(1).number().catch(0) } else { 0 }
          let patch_part = if $parts.length() >= 3 { $parts.index(2) } else { "0" }

          let patch_split = $patch_part.split("-")
          let patch = $patch_split.index(0).number().catch(0)
          let prerelease = if $patch_split.length() > 1 { $patch_split.index(1) } else { "" }

          root.version = $input
          root.major = $major
          root.minor = $minor
          root.patch = $patch
          root.prerelease = $prerelease
          root.valid = $parts.length() >= 3
          root.metadata = {"skill": "semver-parse", "mode": "mcp", "trace_id": meta("trace_id"), "timestamp": now()}

  output:
    sync_response: {}
